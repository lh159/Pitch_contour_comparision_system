# 共振峰频谱图波形表示发音

## 功能概述

频谱镜子现在支持实时共振峰检测和可视化，帮助用户更好地理解和分析发音特征。

## 什么是共振峰？

共振峰（Formants）是语音频谱中能量集中的频率区域，它们决定了元音的音色特征。人类发音时，声道形状会产生不同的共振峰模式，每个元音都有其独特的共振峰特征。

### 四个主要共振峰

1. **F1 (第一共振峰, 200-1200Hz)** - 红色
   - 反映元音的开口度
   - F1越高，口腔开口越大
   - 例如：a（开口）→ i（闭口）

2. **F2 (第二共振峰, 600-3000Hz)** - 绿色
   - 反映舌位的前后位置
   - F2越高，舌位越靠前
   - 例如：u（后）→ i（前）

3. **F3 (第三共振峰, 1400-4000Hz)** - 蓝色
   - 影响音色的圆润度和清晰度
   - 对声音质量有重要影响

4. **F4 (第四共振峰, 2000-5000Hz)** - 黄色
   - 影响音色的明亮度和穿透力
   - 对高频特征敏感

## 功能使用

### 1. 启动频谱镜子

访问：`http://localhost:5000/spectrogram-mirror`

### 2. 开始实时监测

点击"🎤 开始实时监测"按钮，允许麦克风权限后，系统会开始实时显示：
- 频谱图（彩色热力图）
- 波形图（顶部）
- **共振峰标记（彩色圆点）**

### 3. 控制共振峰显示

- 使用"🎯 显示共振峰"复选框来开启/关闭共振峰标记
- 默认情况下，共振峰显示是开启的

### 4. 理解共振峰标记

在频谱图上，您会看到四种颜色的圆点：
- 🔴 **红色** = F1（第一共振峰）
- 🟢 **绿色** = F2（第二共振峰）
- 🔵 **蓝色** = F3（第三共振峰）
- 🟡 **黄色** = F4（第四共振峰）

## 实际应用示例

### 发音"啊"（a）
- F1 较高（约700-900Hz）- 口腔开口大
- F2 中等（约1200-1500Hz）
- 频谱图上会看到红点在较低位置，绿点在中间位置

### 发音"依"（i）
- F1 较低（约250-400Hz）- 口腔开口小
- F2 较高（约2000-2500Hz）- 舌位靠前
- 频谱图上会看到红点在很低位置，绿点在较高位置

### 发音"乌"（u）
- F1 较低（约250-400Hz）- 口腔开口小
- F2 较低（约600-900Hz）- 舌位靠后
- 频谱图上会看到红点和绿点都在较低位置

## 技术实现

### 共振峰检测算法

系统使用峰值检测算法识别共振峰：

```javascript
detectFormants(frequencyData) {
    // 1. 在特定频率范围内搜索能量峰值
    // 2. F1: 200-1200Hz
    // 3. F2: 600-3000Hz
    // 4. F3: 1400-4000Hz
    // 5. F4: 2000-5000Hz
    
    // 返回四个共振峰的频率值
    return { f1, f2, f3, f4 };
}
```

### 可视化方法

```javascript
drawFormants(formants) {
    // 在频谱图上绘制彩色圆点
    // 每个共振峰用不同颜色标记
    // F1: 红色, F2: 绿色, F3: 蓝色, F4: 黄色
}
```

### 控制接口

```javascript
// 切换共振峰显示
spectrogramMirror.toggleFormants(true/false);

// 或通过RealtimeSpectrogramRenderer
renderer.toggleFormants(show);
```

## 性能优化

- 共振峰检测每帧执行一次，计算量小
- 仅在有有效音频信号时进行检测
- 使用高效的峰值搜索算法
- 对性能影响可忽略不计

## 教学应用

### 语音训练
1. 对比标准发音和自己的发音
2. 观察共振峰位置差异
3. 调整发音方式，让共振峰接近目标

### 音色分析
1. 录制不同音色的声音
2. 比较共振峰模式
3. 理解音色的频谱特征

### 发音矫正
1. 实时监测发音
2. 根据共振峰反馈调整
3. 达到标准发音

## 注意事项

1. **麦克风质量**：高质量麦克风能提供更准确的共振峰检测
2. **环境噪音**：安静环境下检测效果更好
3. **发音清晰**：清晰、稳定的发音更容易识别共振峰
4. **浏览器兼容**：建议使用Chrome、Edge或Firefox

## 常见问题

### Q: 为什么看不到共振峰标记？
A: 
- 检查"显示共振峰"开关是否打开
- 确保有足够的音量输入
- 尝试发清晰的元音（如"啊"）

### Q: 共振峰位置不准确？
A: 
- 共振峰检测基于频谱峰值，可能受噪音影响
- 保持发音稳定
- 使用更好的麦克风

### Q: 可以保存共振峰数据吗？
A: 当前版本仅实时显示，未来版本会支持数据导出

## 技术参数

- **FFT大小**：2048
- **采样率**：通常48000Hz或44100Hz
- **频率分辨率**：约23Hz
- **更新频率**：60fps
- **共振峰搜索范围**：
  - F1: 200-1200Hz
  - F2: 600-3000Hz
  - F3: 1400-4000Hz
  - F4: 2000-5000Hz

## 未来改进

- [ ] 共振峰轨迹跟踪（显示历史）
- [ ] 共振峰数值显示
- [ ] 标准发音对比
- [ ] 共振峰数据导出
- [ ] 元音图谱显示（F1-F2平面）
- [ ] 共振峰统计分析

## 相关文档

- [实时频谱可视化演示.md](实时频谱可视化演示.md) - 完整的频谱镜子文档
- [README.md](README.md) - 系统总体介绍

---

**更新时间**: 2024年10月
**版本**: 1.0.0
**作者**: 音高曲线比对系统开发团队
