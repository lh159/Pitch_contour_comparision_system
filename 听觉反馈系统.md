# å¬è§‰åé¦ˆç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## ä¸€ã€ç³»ç»Ÿæ¦‚è¿°

### 1.1 ç›®æ ‡ç”¨æˆ·
å¬éšœäººå£«ï¼Œç”¨äºå¸®åŠ©ä»–ä»¬æ£€æµ‹å’Œæé«˜å¬åŠ›ç†è§£èƒ½åŠ›ã€‚

### 1.2 æ ¸å¿ƒåŠŸèƒ½
1. æ’­æ”¾ç³»ç»Ÿç”Ÿæˆçš„åœºæ™¯å¯¹è¯éŸ³é¢‘ï¼ˆé€å¥æ’­æ”¾ï¼‰
2. ç”¨æˆ·å¬å®Œåè¾“å…¥å¬åˆ°çš„æ–‡å­—å†…å®¹
3. ç³»ç»Ÿè¿›è¡Œæ–‡å­—æ™ºèƒ½æ¯”å¯¹ï¼Œé«˜äº®æ ‡è®°é”™è¯¯
4. å…¨å¯¹æ—¶ç»™äºˆæ­£å‘æ¿€åŠ±åé¦ˆ
5. è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€å¥ï¼Œå®Œæˆå®Œæ•´åœºæ™¯å¯¹è¯

### 1.3 æŠ€æœ¯äº®ç‚¹
- å¤ç”¨ç°æœ‰çš„åœºæ™¯å¯¹è¯ç”ŸæˆåŠŸèƒ½
- æ™ºèƒ½æ–‡å­—æ¯”å¯¹ç®—æ³•ï¼ˆæ”¯æŒåŒéŸ³å­—ã€è¿‘ä¼¼å­—è¯†åˆ«ï¼‰
- å¯è§†åŒ–é”™è¯¯æ ‡è®°
- æ¸¸æˆåŒ–æ¿€åŠ±æœºåˆ¶
- è¿›åº¦ç»Ÿè®¡å’Œåˆ†æ

---

## äºŒã€ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„
```
å‰ç«¯UIå±‚
  â”œâ”€â”€ åœºæ™¯é€‰æ‹©é¡µé¢
  â”œâ”€â”€ å¬åŠ›è®­ç»ƒé¡µé¢ï¼ˆæ ¸å¿ƒï¼‰
  â”œâ”€â”€ ç»“æœç»Ÿè®¡é¡µé¢
  
åç«¯APIå±‚
  â”œâ”€â”€ åœºæ™¯å¯¹è¯ç”ŸæˆAPIï¼ˆå·²æœ‰ï¼‰
  â”œâ”€â”€ æ–‡å­—æ¯”å¯¹APIï¼ˆæ–°å¢ï¼‰
  â”œâ”€â”€ è¿›åº¦ç®¡ç†APIï¼ˆæ–°å¢ï¼‰
  â”œâ”€â”€ ç»Ÿè®¡åˆ†æAPIï¼ˆæ–°å¢ï¼‰
  
æ•°æ®å±‚
  â”œâ”€â”€ è®­ç»ƒä¼šè¯å­˜å‚¨
  â”œâ”€â”€ ç”¨æˆ·ç­”é¢˜è®°å½•
  â”œâ”€â”€ ç»Ÿè®¡æ•°æ®å­˜å‚¨
```

### 2.2 é¡µé¢æµç¨‹å›¾
```
Homeé¡µ â†’ å¬è§‰åé¦ˆå…¥å£
  â†“
åœºæ™¯é€‰æ‹©/ç”Ÿæˆ
  â†“
å¬åŠ›è®­ç»ƒä¸»ç•Œé¢
  â”œâ”€â”€ æ’­æ”¾å½“å‰å¥éŸ³é¢‘
  â”œâ”€â”€ ç”¨æˆ·è¾“å…¥æ–‡å­—
  â”œâ”€â”€ æäº¤æ¯”å¯¹
  â”œâ”€â”€ æ˜¾ç¤ºç»“æœï¼ˆé”™è¯¯æ ‡è®°/æ¿€åŠ±ï¼‰
  â”œâ”€â”€ ä¸‹ä¸€å¥
  â†“
è®­ç»ƒå®ŒæˆæŠ¥å‘Š
  â”œâ”€â”€ æ­£ç¡®ç‡ç»Ÿè®¡
  â”œâ”€â”€ é”™è¯¯ç±»å‹åˆ†æ
  â”œâ”€â”€ å»ºè®®ä¸é¼“åŠ±
```

---

## ä¸‰ã€è¯¦ç»†æ„å»ºæ­¥éª¤

### æ­¥éª¤1: å‰ç«¯UIè®¾è®¡ä¸å®ç°

#### 1.1 åœ¨home.htmlæ·»åŠ å¬è§‰åé¦ˆå…¥å£
**æ–‡ä»¶**: `templates/home.html`

**ä½ç½®**: åœ¨"é€‰æ‹©ç»ƒä¹ æ¨¡å¼"åŒºåŸŸæ·»åŠ ç¬¬ä¸‰ä¸ªé€‰é¡¹

**ä»£ç å®ç°**:
```html
<div class="col-md-4">
    <div class="form-check">
        <input class="form-check-input" type="radio" name="practiceMode" id="feedbackMode" value="feedback">
        <label class="form-check-label fw-bold" for="feedbackMode">
            <i class="fas fa-headphones me-2 text-info"></i>å¬è§‰åé¦ˆæ¨¡å¼ <span class="badge bg-info ms-1">è¾…åŠ©åŠŸèƒ½</span>
        </label>
        <div class="form-text text-muted ms-4">å¸®åŠ©å¬éšœäººå£«æ£€æµ‹å¬åŠ›ç†è§£èƒ½åŠ›</div>
    </div>
</div>
```

#### 1.2 åˆ›å»ºå¬è§‰åé¦ˆè®­ç»ƒé¡µé¢
**æ–‡ä»¶**: `templates/hearing_feedback.html`

**æ ¸å¿ƒç»„ä»¶**:
1. **åœºæ™¯ä¿¡æ¯å¡ç‰‡**
   - æ˜¾ç¤ºåœºæ™¯æ ‡é¢˜å’Œæè¿°
   - æ˜¾ç¤ºå½“å‰è¿›åº¦ï¼ˆç¬¬Xå¥/å…±Yå¥ï¼‰

2. **éŸ³é¢‘æ’­æ”¾åŒºåŸŸ**
   - å¤§å·æ’­æ”¾æŒ‰é’®
   - å¯é‡å¤æ’­æ”¾å½“å‰å¥
   - æ’­æ”¾æ¬¡æ•°ç»Ÿè®¡
   - æ’­æ”¾é€Ÿåº¦è°ƒèŠ‚ï¼ˆ0.75x, 1x, 1.25xï¼‰

3. **æ–‡å­—è¾“å…¥åŒºåŸŸ**
   - å¤§å·æ–‡æœ¬è¾“å…¥æ¡†
   - æ”¯æŒå®æ—¶å­—æ•°ç»Ÿè®¡
   - æ¸…ç©ºæŒ‰é’®
   - æäº¤æŒ‰é’®

4. **ç»“æœå±•ç¤ºåŒºåŸŸ**
   - åŸæ–‡å±•ç¤º
   - ç”¨æˆ·è¾“å…¥å±•ç¤ºï¼ˆé”™è¯¯é«˜äº®ï¼‰
   - æ­£ç¡®ç‡æ˜¾ç¤º
   - æ¿€åŠ±åŠ¨ç”»ï¼ˆå…¨å¯¹æ—¶ï¼‰

5. **æ“ä½œæŒ‰é’®**
   - é‡æ–°å¬ä¸€é
   - ä¸‹ä¸€å¥
   - æŸ¥çœ‹ç»Ÿè®¡
   - é€€å‡ºè®­ç»ƒ

**é¡µé¢å¸ƒå±€ç»“æ„**:
```html
<div class="feedback-container">
    <!-- è¿›åº¦æ¡ -->
    <div class="progress-section">
        <div class="progress-bar"></div>
        <div class="progress-text">ç¬¬ 1 / 10 å¥</div>
    </div>
    
    <!-- éŸ³é¢‘æ’­æ”¾å¡ç‰‡ -->
    <div class="audio-card">
        <button class="play-btn">â–¶ï¸ æ’­æ”¾éŸ³é¢‘</button>
        <div class="play-controls">
            <span>æ’­æ”¾æ¬¡æ•°: 0</span>
            <select class="speed-control">
                <option value="0.75">0.75x</option>
                <option value="1" selected>1x</option>
                <option value="1.25">1.25x</option>
            </select>
        </div>
    </div>
    
    <!-- è¾“å…¥åŒºåŸŸ -->
    <div class="input-card">
        <textarea placeholder="è¯·è¾“å…¥ä½ å¬åˆ°çš„å†…å®¹..."></textarea>
        <div class="input-actions">
            <button class="clear-btn">æ¸…ç©º</button>
            <button class="submit-btn">æäº¤</button>
        </div>
    </div>
    
    <!-- ç»“æœå±•ç¤ºåŒºåŸŸï¼ˆåˆå§‹éšè—ï¼‰-->
    <div class="result-card" style="display:none;">
        <div class="original-text">
            <h5>åŸæ–‡ï¼š</h5>
            <p>è¿™æ˜¯æ ‡å‡†æ–‡æœ¬å†…å®¹</p>
        </div>
        <div class="user-input">
            <h5>æ‚¨çš„è¾“å…¥ï¼š</h5>
            <p>è¿™æ˜¯ç”¨æˆ·è¾“å…¥<span class="error">å†…è£</span></p>
        </div>
        <div class="score">
            <h3>å‡†ç¡®ç‡ï¼š<span class="score-value">90%</span></h3>
        </div>
        <div class="feedback-message">
            <!-- æ¿€åŠ±ä¿¡æ¯ -->
        </div>
    </div>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <div class="action-buttons">
        <button class="replay-btn">ğŸ”„ é‡æ–°å¬</button>
        <button class="next-btn">â¡ï¸ ä¸‹ä¸€å¥</button>
        <button class="stats-btn">ğŸ“Š æŸ¥çœ‹ç»Ÿè®¡</button>
    </div>
</div>
```

#### 1.3 åˆ›å»ºJavaScriptäº¤äº’é€»è¾‘
**æ–‡ä»¶**: `static/js/hearing-feedback.js`

**æ ¸å¿ƒåŠŸèƒ½å®ç°**:

```javascript
class HearingFeedbackTrainer {
    constructor() {
        this.sessionId = null;
        this.dialogueData = null;
        this.currentIndex = 0;
        this.currentAudio = null;
        this.playCount = 0;
        this.records = []; // è®°å½•æ¯å¥çš„ç­”é¢˜æƒ…å†µ
        
        this.initElements();
        this.bindEvents();
    }
    
    // åˆå§‹åŒ–DOMå…ƒç´ 
    initElements() {
        this.playBtn = document.querySelector('.play-btn');
        this.inputArea = document.querySelector('textarea');
        this.submitBtn = document.querySelector('.submit-btn');
        this.resultCard = document.querySelector('.result-card');
        // ... å…¶ä»–å…ƒç´ 
    }
    
    // ç»‘å®šäº‹ä»¶
    bindEvents() {
        this.playBtn.addEventListener('click', () => this.playAudio());
        this.submitBtn.addEventListener('click', () => this.submitAnswer());
        // ... å…¶ä»–äº‹ä»¶
    }
    
    // åŠ è½½åœºæ™¯å¯¹è¯
    async loadDialogue(sessionId) {
        const response = await fetch(`/api/scenario/session/${sessionId}`);
        const data = await response.json();
        if (data.success) {
            this.dialogueData = data.session_data.dialogue_data;
            this.loadSentence(0);
        }
    }
    
    // åŠ è½½å½“å‰å¥å­
    loadSentence(index) {
        const sentence = this.dialogueData.dialogues[index];
        // æ›´æ–°UIï¼Œå‡†å¤‡æ’­æ”¾
        this.currentAudio = new Audio(sentence.audio_url);
        this.playCount = 0;
        this.updateProgress();
    }
    
    // æ’­æ”¾éŸ³é¢‘
    playAudio() {
        if (this.currentAudio) {
            this.currentAudio.play();
            this.playCount++;
            this.updatePlayCount();
        }
    }
    
    // æäº¤ç­”æ¡ˆ
    async submitAnswer() {
        const userInput = this.inputArea.value.trim();
        const originalText = this.dialogueData.dialogues[this.currentIndex].text;
        
        // è°ƒç”¨æ–‡å­—æ¯”å¯¹API
        const response = await fetch('/api/feedback/compare', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                original: originalText,
                user_input: userInput,
                session_id: this.sessionId,
                sentence_index: this.currentIndex
            })
        });
        
        const result = await response.json();
        this.showResult(result);
    }
    
    // æ˜¾ç¤ºæ¯”å¯¹ç»“æœ
    showResult(result) {
        this.resultCard.style.display = 'block';
        
        // æ˜¾ç¤ºåŸæ–‡å’Œç”¨æˆ·è¾“å…¥ï¼ˆå¸¦é”™è¯¯æ ‡è®°ï¼‰
        this.showOriginalText(result.original);
        this.showUserInput(result.user_input_marked);
        
        // æ˜¾ç¤ºå‡†ç¡®ç‡
        this.showAccuracy(result.accuracy);
        
        // æ˜¾ç¤ºæ¿€åŠ±ä¿¡æ¯
        if (result.accuracy === 100) {
            this.showPerfectFeedback();
        } else {
            this.showEncouragementFeedback(result.accuracy);
        }
        
        // ä¿å­˜è®°å½•
        this.records.push({
            index: this.currentIndex,
            original: result.original,
            user_input: result.user_input,
            accuracy: result.accuracy,
            play_count: this.playCount
        });
    }
    
    // ä¸‹ä¸€å¥
    nextSentence() {
        this.currentIndex++;
        if (this.currentIndex < this.dialogueData.dialogues.length) {
            this.loadSentence(this.currentIndex);
            this.resetUI();
        } else {
            this.showFinalReport();
        }
    }
    
    // æ˜¾ç¤ºæœ€ç»ˆæŠ¥å‘Š
    showFinalReport() {
        // è·³è½¬åˆ°ç»Ÿè®¡é¡µé¢
        window.location.href = '/feedback-report?session=' + this.sessionId;
    }
}

// åˆå§‹åŒ–
const trainer = new HearingFeedbackTrainer();
```

#### 1.4 CSSæ ·å¼è®¾è®¡
**æ–‡ä»¶**: `static/css/hearing-feedback.css`

**æ ¸å¿ƒæ ·å¼**:
- å¤§å·æŒ‰é’®å’Œæ–‡å­—ï¼ˆé€‚åˆè§†åŠ›è¾…åŠ©ï¼‰
- é«˜å¯¹æ¯”åº¦é…è‰²æ–¹æ¡ˆ
- æ¸…æ™°çš„è§†è§‰åé¦ˆï¼ˆé”™è¯¯ç”¨çº¢è‰²ï¼Œæ­£ç¡®ç”¨ç»¿è‰²ï¼‰
- æµç•…çš„åŠ¨ç”»æ•ˆæœ
- å“åº”å¼å¸ƒå±€ï¼ˆæ”¯æŒç§»åŠ¨ç«¯ï¼‰

---

### æ­¥éª¤2: åç«¯APIå¼€å‘

#### 2.1 æ–‡å­—æ¯”å¯¹ç®—æ³•å®ç°
**æ–‡ä»¶**: `text_comparator.py`

**æ ¸å¿ƒç®—æ³•**:

```python
# -*- coding: utf-8 -*-
"""
æ–‡å­—æ¯”å¯¹æ¨¡å—
ç”¨äºå¬è§‰åé¦ˆç³»ç»Ÿçš„æ–‡å­—æ™ºèƒ½æ¯”å¯¹
"""

import difflib
from typing import Dict, List, Tuple
import re

class TextComparator:
    """æ–‡å­—æ¯”å¯¹å™¨"""
    
    def __init__(self):
        # åŒéŸ³å­—æ˜ å°„è¡¨
        self.homophone_map = self._load_homophone_map()
        
        # å½¢è¿‘å­—æ˜ å°„è¡¨
        self.similar_char_map = self._load_similar_char_map()
    
    def compare(self, original: str, user_input: str) -> Dict:
        """
        æ™ºèƒ½æ¯”å¯¹ä¸¤æ®µæ–‡å­—
        
        Args:
            original: åŸå§‹æ–‡æœ¬
            user_input: ç”¨æˆ·è¾“å…¥
            
        Returns:
            Dict: æ¯”å¯¹ç»“æœ
        """
        # 1. é¢„å¤„ç†
        original_clean = self._preprocess(original)
        user_input_clean = self._preprocess(user_input)
        
        # 2. è®¡ç®—ç¼–è¾‘è·ç¦»
        distance = self._edit_distance(original_clean, user_input_clean)
        
        # 3. å­—ç¬¦çº§åˆ«å¯¹æ¯”
        char_diff = self._char_level_diff(original_clean, user_input_clean)
        
        # 4. æ ‡è®°é”™è¯¯
        marked_text = self._mark_errors(user_input, char_diff)
        
        # 5. è®¡ç®—å‡†ç¡®ç‡
        accuracy = self._calculate_accuracy(original_clean, user_input_clean, distance)
        
        # 6. é”™è¯¯åˆ†æ
        error_analysis = self._analyze_errors(char_diff)
        
        return {
            'original': original,
            'user_input': user_input,
            'user_input_marked': marked_text,
            'accuracy': accuracy,
            'error_count': error_analysis['total_errors'],
            'error_types': error_analysis['error_types'],
            'suggestions': self._generate_suggestions(error_analysis)
        }
    
    def _preprocess(self, text: str) -> str:
        """é¢„å¤„ç†æ–‡æœ¬"""
        # å»é™¤ç©ºæ ¼ã€æ ‡ç‚¹ç¬¦å·
        text = re.sub(r'[^\w]', '', text)
        return text.strip()
    
    def _edit_distance(self, s1: str, s2: str) -> int:
        """è®¡ç®—ç¼–è¾‘è·ç¦»ï¼ˆLevenshteinè·ç¦»ï¼‰"""
        m, n = len(s1), len(s2)
        dp = [[0] * (n + 1) for _ in range(m + 1)]
        
        for i in range(m + 1):
            dp[i][0] = i
        for j in range(n + 1):
            dp[0][j] = j
        
        for i in range(1, m + 1):
            for j in range(1, n + 1):
                if s1[i-1] == s2[j-1]:
                    dp[i][j] = dp[i-1][j-1]
                else:
                    dp[i][j] = min(
                        dp[i-1][j] + 1,    # åˆ é™¤
                        dp[i][j-1] + 1,    # æ’å…¥
                        dp[i-1][j-1] + 1   # æ›¿æ¢
                    )
        
        return dp[m][n]
    
    def _char_level_diff(self, s1: str, s2: str) -> List[Tuple]:
        """
        å­—ç¬¦çº§åˆ«å·®å¼‚æ¯”å¯¹
        è¿”å›æ ¼å¼: [('equal', 'a'), ('replace', 'b', 'c'), ('delete', 'd')]
        """
        matcher = difflib.SequenceMatcher(None, s1, s2)
        diffs = []
        
        for tag, i1, i2, j1, j2 in matcher.get_opcodes():
            if tag == 'equal':
                for k in range(i1, i2):
                    diffs.append(('equal', s1[k]))
            elif tag == 'replace':
                # æ£€æŸ¥æ˜¯å¦æ˜¯åŒéŸ³å­—æˆ–å½¢è¿‘å­—
                if self._is_homophone(s1[i1:i2], s2[j1:j2]):
                    diffs.append(('homophone', s1[i1:i2], s2[j1:j2]))
                elif self._is_similar_char(s1[i1:i2], s2[j1:j2]):
                    diffs.append(('similar', s1[i1:i2], s2[j1:j2]))
                else:
                    diffs.append(('replace', s1[i1:i2], s2[j1:j2]))
            elif tag == 'delete':
                diffs.append(('delete', s1[i1:i2]))
            elif tag == 'insert':
                diffs.append(('insert', s2[j1:j2]))
        
        return diffs
    
    def _mark_errors(self, user_input: str, char_diff: List) -> str:
        """æ ‡è®°é”™è¯¯çš„HTML"""
        marked = []
        
        for item in char_diff:
            if item[0] == 'equal':
                marked.append(item[1])
            elif item[0] == 'replace':
                marked.append(f'<span class="error-replace" title="åº”ä¸ºï¼š{item[1]}">{item[2]}</span>')
            elif item[0] == 'homophone':
                marked.append(f'<span class="error-homophone" title="åŒéŸ³å­—ï¼Œåº”ä¸ºï¼š{item[1]}">{item[2]}</span>')
            elif item[0] == 'similar':
                marked.append(f'<span class="error-similar" title="å½¢è¿‘å­—ï¼Œåº”ä¸ºï¼š{item[1]}">{item[2]}</span>')
            elif item[0] == 'delete':
                marked.append(f'<span class="error-missing" title="ç¼ºå°‘ï¼š{item[1]}">_</span>')
            elif item[0] == 'insert':
                marked.append(f'<span class="error-extra">{item[1]}</span>')
        
        return ''.join(marked)
    
    def _calculate_accuracy(self, original: str, user_input: str, distance: int) -> float:
        """è®¡ç®—å‡†ç¡®ç‡"""
        max_len = max(len(original), len(user_input))
        if max_len == 0:
            return 100.0
        
        accuracy = (1 - distance / max_len) * 100
        return round(accuracy, 2)
    
    def _analyze_errors(self, char_diff: List) -> Dict:
        """é”™è¯¯åˆ†æ"""
        error_types = {
            'replace': 0,
            'homophone': 0,
            'similar': 0,
            'missing': 0,
            'extra': 0
        }
        
        for item in char_diff:
            if item[0] in error_types:
                error_types[item[0]] += 1
        
        total_errors = sum(error_types.values())
        
        return {
            'total_errors': total_errors,
            'error_types': error_types
        }
    
    def _generate_suggestions(self, error_analysis: Dict) -> List[str]:
        """ç”Ÿæˆæ”¹è¿›å»ºè®®"""
        suggestions = []
        error_types = error_analysis['error_types']
        
        if error_types['homophone'] > 2:
            suggestions.append('æ³¨æ„åŒºåˆ†åŒéŸ³å­—ï¼Œå¯ä»¥ç»“åˆä¸Šä¸‹æ–‡ç†è§£')
        if error_types['similar'] > 2:
            suggestions.append('æ³¨æ„å½¢è¿‘å­—çš„åŒºåˆ«ï¼Œå»ºè®®åŠ å¼ºå­—å½¢è¾¨è¯†ç»ƒä¹ ')
        if error_types['missing'] > 2:
            suggestions.append('æœ‰äº›å­—å¯èƒ½å¬æ¼äº†ï¼Œå¯ä»¥å°è¯•é™ä½æ’­æ”¾é€Ÿåº¦')
        if error_types['extra'] > 2:
            suggestions.append('æœ‰äº›å­—å¯èƒ½å¬å¤šäº†ï¼Œæ³¨æ„éŸ³é¢‘çš„å®Œæ•´æ€§')
        
        if not suggestions:
            suggestions.append('ç»§ç»­ä¿æŒï¼Œä½ åšå¾—å¾ˆå¥½ï¼')
        
        return suggestions
    
    def _is_homophone(self, char1: str, char2: str) -> bool:
        """åˆ¤æ–­æ˜¯å¦æ˜¯åŒéŸ³å­—"""
        # è¿™é‡Œéœ€è¦å®ç°åŒéŸ³å­—åˆ¤æ–­é€»è¾‘
        # å¯ä»¥ä½¿ç”¨pypinyinåº“
        return False
    
    def _is_similar_char(self, char1: str, char2: str) -> bool:
        """åˆ¤æ–­æ˜¯å¦æ˜¯å½¢è¿‘å­—"""
        # å®ç°å½¢è¿‘å­—åˆ¤æ–­é€»è¾‘
        return False
    
    def _load_homophone_map(self) -> Dict:
        """åŠ è½½åŒéŸ³å­—æ˜ å°„è¡¨"""
        # å¯ä»¥ä»æ–‡ä»¶æˆ–æ•°æ®åº“åŠ è½½
        return {}
    
    def _load_similar_char_map(self) -> Dict:
        """åŠ è½½å½¢è¿‘å­—æ˜ å°„è¡¨"""
        return {}
```

#### 2.2 æ·»åŠ APIç«¯ç‚¹
**æ–‡ä»¶**: `web_interface.py`

**æ–°å¢è·¯ç”±**:

```python
# å¯¼å…¥æ–‡å­—æ¯”å¯¹æ¨¡å—
from text_comparator import TextComparator

# åˆå§‹åŒ–æ–‡å­—æ¯”å¯¹å™¨
text_comparator = TextComparator()

# å¬è§‰åé¦ˆä¼šè¯å­˜å‚¨
feedback_sessions = {}

@app.route('/hearing-feedback')
def hearing_feedback_page():
    """å¬è§‰åé¦ˆè®­ç»ƒé¡µé¢"""
    return render_template('hearing_feedback.html')

@app.route('/api/feedback/start', methods=['POST'])
def start_feedback_session():
    """å¼€å§‹å¬è§‰åé¦ˆè®­ç»ƒä¼šè¯"""
    try:
        data = request.get_json()
        scenario = data.get('scenario', '').strip()
        
        # ç”Ÿæˆåœºæ™¯å¯¹è¯
        generator = get_deepseek_generator()
        result = generator.generate_scenario_dialogue(scenario, Config.DEFAULT_DIALOGUE_ROUNDS)
        
        if result.get('success'):
            # åˆ›å»ºè®­ç»ƒä¼šè¯
            session_id = str(uuid.uuid4())
            feedback_sessions[session_id] = {
                'dialogue_data': result['data'],
                'scenario': scenario,
                'start_time': time.time(),
                'records': [],
                'current_index': 0
            }
            
            return jsonify({
                'success': True,
                'session_id': session_id,
                'dialogue_data': result['data']
            })
        else:
            return jsonify({
                'success': False,
                'error': 'åœºæ™¯å¯¹è¯ç”Ÿæˆå¤±è´¥'
            }), 500
            
    except Exception as e:
        return jsonify({
            'success': False,
            'error': str(e)
        }), 500

@app.route('/api/feedback/compare', methods=['POST'])
def compare_feedback_text():
    """æ–‡å­—æ¯”å¯¹API"""
    try:
        data = request.get_json()
        original = data.get('original', '')
        user_input = data.get('user_input', '')
        session_id = data.get('session_id')
        sentence_index = data.get('sentence_index', 0)
        
        # è¿›è¡Œæ–‡å­—æ¯”å¯¹
        result = text_comparator.compare(original, user_input)
        
        # ä¿å­˜åˆ°ä¼šè¯è®°å½•
        if session_id in feedback_sessions:
            feedback_sessions[session_id]['records'].append({
                'index': sentence_index,
                'original': original,
                'user_input': user_input,
                'accuracy': result['accuracy'],
                'timestamp': time.time()
            })
        
        return jsonify({
            'success': True,
            **result
        })
        
    except Exception as e:
        return jsonify({
            'success': False,
            'error': str(e)
        }), 500

@app.route('/api/feedback/stats/<session_id>', methods=['GET'])
def get_feedback_stats(session_id):
    """è·å–è®­ç»ƒç»Ÿè®¡"""
    try:
        if session_id not in feedback_sessions:
            return jsonify({
                'success': False,
                'error': 'ä¼šè¯ä¸å­˜åœ¨'
            }), 404
        
        session = feedback_sessions[session_id]
        records = session['records']
        
        # è®¡ç®—ç»Ÿè®¡æ•°æ®
        total_sentences = len(records)
        total_accuracy = sum(r['accuracy'] for r in records)
        avg_accuracy = total_accuracy / total_sentences if total_sentences > 0 else 0
        
        perfect_count = sum(1 for r in records if r['accuracy'] == 100)
        
        stats = {
            'total_sentences': total_sentences,
            'completed_sentences': len(records),
            'average_accuracy': round(avg_accuracy, 2),
            'perfect_count': perfect_count,
            'perfect_rate': round(perfect_count / total_sentences * 100, 2) if total_sentences > 0 else 0,
            'training_duration': time.time() - session['start_time'],
            'records': records
        }
        
        return jsonify({
            'success': True,
            'stats': stats
        })
        
    except Exception as e:
        return jsonify({
            'success': False,
            'error': str(e)
        }), 500

@app.route('/feedback-report')
def feedback_report_page():
    """å¬è§‰åé¦ˆè®­ç»ƒæŠ¥å‘Šé¡µé¢"""
    return render_template('feedback_report.html')
```

---

### æ­¥éª¤3: æ•°æ®åº“è®¾è®¡ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦æŒä¹…åŒ–å­˜å‚¨ç”¨æˆ·è®­ç»ƒæ•°æ®ï¼Œå¯ä»¥è®¾è®¡ä»¥ä¸‹æ•°æ®è¡¨ï¼š

#### 3.1 è®­ç»ƒä¼šè¯è¡¨ (feedback_sessions)
```sql
CREATE TABLE feedback_sessions (
    id VARCHAR(36) PRIMARY KEY,
    user_id VARCHAR(36),
    scenario TEXT,
    start_time TIMESTAMP,
    end_time TIMESTAMP,
    total_sentences INT,
    average_accuracy FLOAT,
    status VARCHAR(20)  -- 'in_progress', 'completed', 'abandoned'
);
```

#### 3.2 ç­”é¢˜è®°å½•è¡¨ (feedback_records)
```sql
CREATE TABLE feedback_records (
    id INT AUTO_INCREMENT PRIMARY KEY,
    session_id VARCHAR(36),
    sentence_index INT,
    original_text TEXT,
    user_input TEXT,
    accuracy FLOAT,
    play_count INT,
    timestamp TIMESTAMP,
    FOREIGN KEY (session_id) REFERENCES feedback_sessions(id)
);
```

#### 3.3 é”™è¯¯ç»Ÿè®¡è¡¨ (feedback_errors)
```sql
CREATE TABLE feedback_errors (
    id INT AUTO_INCREMENT PRIMARY KEY,
    record_id INT,
    error_type VARCHAR(20),  -- 'replace', 'homophone', 'similar', 'missing', 'extra'
    error_position INT,
    expected_char VARCHAR(10),
    actual_char VARCHAR(10),
    FOREIGN KEY (record_id) REFERENCES feedback_records(id)
);
```

---

### æ­¥éª¤4: æ¿€åŠ±ç³»ç»Ÿè®¾è®¡

#### 4.1 å³æ—¶åé¦ˆ
- **100%å‡†ç¡®**: 
  - æ˜¾ç¤ºğŸ‰åº†ç¥åŠ¨ç”»
  - æ–‡å­—ï¼š"å¤ªæ£’äº†ï¼å®Œå…¨æ­£ç¡®ï¼"
  - éŸ³æ•ˆï¼šæˆåŠŸéŸ³æ•ˆ

- **90-99%å‡†ç¡®**:
  - æ˜¾ç¤ºğŸ‘ç‚¹èµå›¾æ ‡
  - æ–‡å­—ï¼š"éå¸¸å¥½ï¼åªæœ‰å°ç‘•ç–µ"
  - æ˜¾ç¤ºå…·ä½“é”™è¯¯

- **70-89%å‡†ç¡®**:
  - æ˜¾ç¤ºğŸ’ªåŠ æ²¹å›¾æ ‡
  - æ–‡å­—ï¼š"ä¸é”™ï¼ç»§ç»­åŠ æ²¹"
  - å»ºè®®é‡å¬æˆ–é™ä½é€Ÿåº¦

- **<70%å‡†ç¡®**:
  - æ˜¾ç¤ºğŸ¤”æ€è€ƒå›¾æ ‡
  - æ–‡å­—ï¼š"æ²¡å…³ç³»ï¼Œå†è¯•ä¸€æ¬¡å§"
  - å»ºè®®é™ä½é€Ÿåº¦ã€å¤šå¬å‡ é

#### 4.2 æˆå°±ç³»ç»Ÿ
```javascript
const achievements = {
    'first_perfect': {
        name: 'é¦–æ¬¡æ»¡åˆ†',
        icon: 'ğŸŒŸ',
        condition: (stats) => stats.perfect_count >= 1
    },
    'five_perfect': {
        name: 'äº”è¿å‡»',
        icon: 'ğŸ”¥',
        condition: (stats) => stats.consecutive_perfect >= 5
    },
    'accuracy_90': {
        name: 'ä¼˜ç­‰ç”Ÿ',
        icon: 'ğŸ“',
        condition: (stats) => stats.average_accuracy >= 90
    },
    'persistent': {
        name: 'åšæŒä¸æ‡ˆ',
        icon: 'ğŸ’ª',
        condition: (stats) => stats.total_sentences >= 50
    }
};
```

---

### æ­¥éª¤5: ç”¨æˆ·ä½“éªŒä¼˜åŒ–

#### 5.1 æ— éšœç¢è®¾è®¡
- å¤§å·æŒ‰é’®ï¼ˆæœ€å° 60x60pxï¼‰
- é«˜å¯¹æ¯”åº¦é…è‰²ï¼ˆWCAG AAæ ‡å‡†ï¼‰
- æ”¯æŒé”®ç›˜æ“ä½œï¼ˆç©ºæ ¼æ’­æ”¾ã€å›è½¦æäº¤ï¼‰
- è¯­éŸ³æç¤ºï¼ˆTTSæœ—è¯»ç»“æœï¼‰

#### 5.2 ä¸ªæ€§åŒ–è®¾ç½®
```javascript
{
    'playbackSpeed': [0.5, 0.75, 1.0, 1.25],  // æ’­æ”¾é€Ÿåº¦
    'fontSize': ['small', 'medium', 'large'],  // å­—ä½“å¤§å°
    'theme': ['light', 'dark', 'high-contrast'],  // ä¸»é¢˜
    'autoNext': true,  // è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€å¥
    'showHints': true,  // æ˜¾ç¤ºæç¤º
    'strictMode': false  // ä¸¥æ ¼æ¨¡å¼ï¼ˆåŒéŸ³å­—ä¹Ÿç®—é”™ï¼‰
}
```

#### 5.3 æ¸è¿›å¼éš¾åº¦
- **ç®€å•**: çŸ­å¥ï¼ˆ5-10å­—ï¼‰ï¼Œæ…¢é€Ÿæ’­æ”¾
- **ä¸­ç­‰**: ä¸­ç­‰é•¿åº¦ï¼ˆ10-20å­—ï¼‰ï¼Œæ­£å¸¸é€Ÿåº¦
- **å›°éš¾**: é•¿å¥ï¼ˆ20-30å­—ï¼‰ï¼Œå¿«é€Ÿæ’­æ”¾
- **ä¸“å®¶**: å¤æ‚åœºæ™¯ï¼Œæœ‰èƒŒæ™¯éŸ³

---

### æ­¥éª¤6: æµ‹è¯•ä¸éƒ¨ç½²

#### 6.1 åŠŸèƒ½æµ‹è¯•æ¸…å•
- [ ] åœºæ™¯å¯¹è¯ç”Ÿæˆæ­£å¸¸
- [ ] éŸ³é¢‘æ’­æ”¾æµç•…
- [ ] æ–‡å­—è¾“å…¥æ— å»¶è¿Ÿ
- [ ] æ¯”å¯¹ç®—æ³•å‡†ç¡®
- [ ] é”™è¯¯æ ‡è®°æ¸…æ™°
- [ ] æ¿€åŠ±ç³»ç»Ÿè§¦å‘æ­£å¸¸
- [ ] ç»Ÿè®¡æ•°æ®å‡†ç¡®
- [ ] ç§»åŠ¨ç«¯é€‚é…è‰¯å¥½

#### 6.2 æ€§èƒ½æµ‹è¯•
- é¡µé¢åŠ è½½æ—¶é—´ < 2ç§’
- APIå“åº”æ—¶é—´ < 500ms
- æ–‡å­—æ¯”å¯¹ç®—æ³• < 100ms
- éŸ³é¢‘åŠ è½½æ—¶é—´ < 1ç§’

#### 6.3 ç”¨æˆ·æµ‹è¯•
- é‚€è¯·5-10åå¬éšœäººå£«æµ‹è¯•
- æ”¶é›†åé¦ˆæ„è§
- ä¼˜åŒ–äº¤äº’æµç¨‹
- è°ƒæ•´éš¾åº¦è®¾ç½®

---

## å››ã€æŠ€æœ¯æ ˆæ€»ç»“

### å‰ç«¯
- HTML5 + CSS3
- JavaScript (ES6+)
- Bootstrap 5ï¼ˆUIæ¡†æ¶ï¼‰
- Font Awesomeï¼ˆå›¾æ ‡ï¼‰
- Web Audio APIï¼ˆéŸ³é¢‘æ§åˆ¶ï¼‰

### åç«¯
- Python 3.8+
- Flaskï¼ˆWebæ¡†æ¶ï¼‰
- difflibï¼ˆæ–‡å­—æ¯”å¯¹ï¼‰
- pypinyinï¼ˆæ‹¼éŸ³å¤„ç†ï¼Œå¯é€‰ï¼‰

### å·²å¤ç”¨çš„ç³»ç»ŸåŠŸèƒ½
- åœºæ™¯å¯¹è¯ç”Ÿæˆï¼ˆDeepSeek APIï¼‰
- TTSéŸ³é¢‘ç”Ÿæˆï¼ˆé˜¿é‡Œäº‘æƒ…æ„ŸTTSï¼‰
- ç°æœ‰çš„UIç»„ä»¶å’Œæ ·å¼

---

## äº”ã€å¼€å‘æ—¶é—´ä¼°ç®—

| æ¨¡å— | é¢„ä¼°æ—¶é—´ |
|-----|---------|
| å‰ç«¯UIå¼€å‘ | 2-3å¤© |
| åç«¯APIå¼€å‘ | 2-3å¤© |
| æ–‡å­—æ¯”å¯¹ç®—æ³• | 2-3å¤© |
| æ¿€åŠ±ç³»ç»Ÿ | 1å¤© |
| æµ‹è¯•ä¸ä¼˜åŒ– | 2-3å¤© |
| **æ€»è®¡** | **9-13å¤©** |

---

## å…­ã€åç»­æ‰©å±•æ–¹å‘

1. **AIæ™ºèƒ½è¯„ä¼°**: ä½¿ç”¨NLPåˆ†æç”¨æˆ·çš„é•¿æœŸè¿›æ­¥è¶‹åŠ¿
2. **å¤šäººåä½œ**: æ”¯æŒå®¶åº­æˆå‘˜é™ªåŒè®­ç»ƒæ¨¡å¼
3. **è¯­éŸ³è¯†åˆ«**: è®©ç”¨æˆ·è¯´å‡ºå¬åˆ°çš„å†…å®¹ï¼ˆè¯­éŸ³è½¬æ–‡å­—ï¼‰
4. **è§†é¢‘å­—å¹•**: å¢åŠ è§†é¢‘åœºæ™¯ï¼Œå¸¦å­—å¹•è¾…åŠ©
5. **ç¤¾åŒºåŠŸèƒ½**: ç”¨æˆ·å¯ä»¥åˆ†äº«è®­ç»ƒæˆæœå’Œç»éªŒ
6. **åº·å¤è®¡åˆ’**: ä¸“ä¸šå¬åŠ›å¸ˆå¯ä»¥åˆ¶å®šä¸ªæ€§åŒ–è®­ç»ƒè®¡åˆ’

---

## ä¸ƒã€æ³¨æ„äº‹é¡¹

1. **éšç§ä¿æŠ¤**: ç”¨æˆ·è®­ç»ƒæ•°æ®è¦åŠ å¯†å­˜å‚¨ï¼Œä¸å¾—å¤–æ³„
2. **åŒ»ç–—å…è´£**: è¯´æ˜æœ¬ç³»ç»Ÿæ˜¯è¾…åŠ©å·¥å…·ï¼Œä¸æ›¿ä»£ä¸“ä¸šåŒ»ç–—å»ºè®®
3. **æ— éšœç¢æ ‡å‡†**: ä¸¥æ ¼éµå¾ªWCAG 2.1 AAæ ‡å‡†
4. **æ€§èƒ½ä¼˜åŒ–**: ç¡®ä¿åœ¨ä½ç«¯è®¾å¤‡ä¸Šä¹Ÿèƒ½æµç•…è¿è¡Œ
5. **é”™è¯¯å¤„ç†**: ç½‘ç»œæ–­çº¿ã€APIå¤±è´¥ç­‰å¼‚å¸¸æƒ…å†µè¦å‹å¥½æç¤º

---

## å…«ã€å¼€å‘ä¼˜å…ˆçº§

### P0ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼Œå¿…é¡»å®Œæˆï¼‰
- éŸ³é¢‘æ’­æ”¾
- æ–‡å­—è¾“å…¥
- åŸºç¡€æ¯”å¯¹ç®—æ³•
- ç»“æœå±•ç¤º

### P1ï¼ˆé‡è¦åŠŸèƒ½ï¼Œåº”è¯¥å®Œæˆï¼‰
- é”™è¯¯æ ‡è®°
- å‡†ç¡®ç‡è®¡ç®—
- æ¿€åŠ±åé¦ˆ
- è¿›åº¦ç»Ÿè®¡

### P2ï¼ˆå¢å¼ºåŠŸèƒ½ï¼Œå¯ä»¥å»¶åï¼‰
- åŒéŸ³å­—è¯†åˆ«
- å½¢è¿‘å­—è¯†åˆ«
- æˆå°±ç³»ç»Ÿ
- ä¸ªæ€§åŒ–è®¾ç½®

### P3ï¼ˆé«˜çº§åŠŸèƒ½ï¼Œæœ‰æ—¶é—´å†åšï¼‰
- æ•°æ®æŒä¹…åŒ–
- ç”¨æˆ·è´¦å·ç³»ç»Ÿ
- è®­ç»ƒæŠ¥å‘Šå¯¼å‡º
- ç¤¾åŒºåŠŸèƒ½

---

## ä¹ã€å¼€å‘èµ·æ­¥

### ç¬¬ä¸€æ­¥ï¼šä¿®æ”¹home.html
åœ¨"é€‰æ‹©ç»ƒä¹ æ¨¡å¼"åŒºåŸŸæ·»åŠ å¬è§‰åé¦ˆé€‰é¡¹ã€‚

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºhearing_feedback.html
å¤åˆ¶standard_audio.htmlä½œä¸ºæ¨¡æ¿ï¼Œä¿®æ”¹ä¸ºå¬è§‰åé¦ˆç•Œé¢ã€‚

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºhearing-feedback.js
å®ç°åŸºæœ¬çš„éŸ³é¢‘æ’­æ”¾å’Œæ–‡å­—è¾“å…¥äº¤äº’ã€‚

### ç¬¬å››æ­¥ï¼šå®ç°text_comparator.py
å…ˆå®ç°åŸºç¡€çš„å­—ç¬¦ä¸²æ¯”å¯¹ï¼Œåç»­å†ä¼˜åŒ–åŒéŸ³å­—ç­‰é«˜çº§åŠŸèƒ½ã€‚

### ç¬¬äº”æ­¥ï¼šæ·»åŠ APIè·¯ç”±
åœ¨web_interface.pyä¸­æ·»åŠ å¿…è¦çš„APIç«¯ç‚¹ã€‚

### ç¬¬å…­æ­¥ï¼šæµ‹è¯•ä¸è¿­ä»£
é€æ­¥æµ‹è¯•æ¯ä¸ªåŠŸèƒ½ï¼Œæ ¹æ®åé¦ˆä¼˜åŒ–ä½“éªŒã€‚

---

**å¼€å‘å»ºè®®**: é‡‡ç”¨æ•æ·å¼€å‘æ–¹æ³•ï¼Œå…ˆå®ŒæˆMVPï¼ˆæœ€å°å¯è¡Œäº§å“ï¼‰ï¼Œå†é€æ­¥æ·»åŠ é«˜çº§åŠŸèƒ½ã€‚å»ºè®®æ¯å®Œæˆä¸€ä¸ªåŠŸèƒ½æ¨¡å—å°±è¿›è¡Œæµ‹è¯•ï¼Œé¿å…æœ€åé›†ä¸­è°ƒè¯•ã€‚

ç¥å¼€å‘é¡ºåˆ©ï¼ğŸš€

