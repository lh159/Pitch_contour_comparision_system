# 音高曲线比对系统 - 多页面应用说明

## 🎯 项目概述

音高曲线比对系统已成功从单页面应用(SPA)重构为多页面应用(MPA)，提供更好的用户体验和页面管理。

## 📱 H5移动端优化特性

- **完整移动端适配**: 支持iPhone、iPad、Android等设备
- **响应式布局**: 支持768px和576px断点
- **触摸交互优化**: 振动反馈、触摸目标大小优化
- **性能优化**: 硬件加速、减少重绘重排
- **用户体验**: 防止缩放、优化字体渲染

## 🗂️ 页面结构

### 1. 首页 (`/home` 或 `/`)
- **文件**: `templates/home.html`
- **功能**: 选择练习模式（基础模式/场景对话模式）
- **特性**: 
  - 支持直接输入文本练习
  - AI生成场景对话
  - TTS声音和情感风格选择

### 2. 标准发音页面 (`/standard-audio`)
- **文件**: `templates/standard_audio.html`
- **功能**: 播放标准发音，提供音高分析
- **特性**:
  - 实时同步文本显示
  - 音高曲线可视化
  - 中文声调分析

### 3. 录音界面 (`/recording`)
- **文件**: `templates/recording.html`
- **功能**: 录制用户发音
- **特性**:
  - 实时指导录音模式
  - 自由录音模式
  - 文件上传支持

### 4. 结果分析页面 (`/results`)
- **文件**: `templates/results.html`
- **功能**: 显示音高比对结果
- **特性**:
  - 详细评分展示
  - 音高曲线对比图
  - 场景对话进度管理

### 5. 原有单页面应用 (`/legacy`)
- **文件**: `templates/index.html`
- **功能**: 保留的原有单页面版本
- **用途**: 备用或兼容性需求

## 🎨 通用资源

### CSS文件
- `static/css/common.css` - 通用样式，包含移动端优化
- `static/css/realtime-sync.css` - 实时同步组件样式

### JavaScript文件
- `static/js/common.js` - 通用功能（设备检测、导航、提示等）
- `static/js/realtime-sync.js` - 实时同步组件
- `static/js/recording-guide.js` - 录音指导组件
- `static/js/chinese-tone-analyzer.js` - 中文声调分析

## 🔄 页面导航流程

```
首页 (选择模式)
    ↓
标准发音页面 (播放和分析)
    ↓
录音界面 (录制发音)
    ↓
结果分析页面 (查看结果)
    ↓
[场景对话模式] 继续对话 → 返回标准发音页面
[基础模式] 重新练习 → 返回首页
```

## 🛠️ 技术实现

### 前端技术
- **HTML5**: 语义化标签，移动端meta标签
- **CSS3**: Flexbox、Grid布局，媒体查询响应式
- **JavaScript ES6+**: 模块化设计，异步处理
- **Bootstrap 5**: UI组件库
- **Font Awesome**: 图标库

### 后端路由 (Flask)
```python
@app.route('/')           # 首页重定向
@app.route('/home')       # 首页
@app.route('/standard-audio')  # 标准发音页面
@app.route('/recording')  # 录音界面
@app.route('/results')    # 结果分析页面
@app.route('/legacy')     # 原有单页面应用
```

### 参数传递
页面间通过URL参数传递数据：
- `file_id`: 音频文件ID
- `text`: 练习文本
- `mode`: 练习模式（basic/dialogue）
- `session_id`: 场景对话会话ID
- `current_order`: 当前对话序号

## 📱 移动端特性详解

### 设备适配
- **iPhone**: 完整支持，包括刘海屏适配
- **iPad**: 优化的平板体验
- **Android**: 全面兼容各种屏幕尺寸
- **触摸设备检测**: 自动识别并优化交互

### 性能优化
- **硬件加速**: 关键元素使用GPU加速
- **懒加载**: 按需加载资源
- **缓存策略**: 智能缓存管理
- **网络优化**: 压缩传输，减少请求

### 用户体验
- **振动反馈**: 支持触摸反馈
- **防误触**: 优化触摸目标大小
- **无缩放**: 防止意外缩放
- **流畅动画**: 60fps动画效果

## 🚀 部署说明

### 开发环境
```bash
# 启动开发服务器
python web_interface.py

# 测试页面可用性
python test_pages.py
```

### 生产环境
```bash
# 使用Docker部署
docker build -t pitch-comparison-system .
docker run -p 5000:5000 pitch-comparison-system

# 或使用快速部署脚本
./quick_deploy.sh
```

## 🔧 配置说明

### 环境变量
- `FLASK_ENV`: 运行环境（development/production）
- `SECRET_KEY`: Flask密钥
- `TTS_ENGINE`: 默认TTS引擎

### 功能开关
- 实时同步功能
- 录音指导功能
- 场景对话功能
- 音高分析功能

## 📊 监控和调试

### 日志系统
- 页面访问日志
- API调用日志
- 错误异常日志

### 性能监控
- 页面加载时间
- API响应时间
- 移动端性能指标

## 🔄 版本兼容

- **新版本**: 多页面应用（推荐）
- **旧版本**: 单页面应用（`/legacy`路径访问）
- **平滑迁移**: 支持逐步迁移用户

## 📝 开发指南

### 添加新页面
1. 在`templates/`目录创建HTML文件
2. 在`web_interface.py`添加路由
3. 更新`common.js`的导航逻辑
4. 测试页面功能

### 修改样式
1. 通用样式修改`static/css/common.css`
2. 页面特定样式直接在HTML中定义
3. 确保移动端兼容性

### 调试技巧
1. 使用浏览器开发者工具
2. 移动端调试使用Chrome DevTools
3. 查看控制台日志和网络请求
4. 使用`test_pages.py`验证页面状态

## 🎉 总结

多页面应用重构成功实现了：
- ✅ 更好的用户体验和页面管理
- ✅ 完整的H5移动端适配
- ✅ 模块化的代码结构
- ✅ 灵活的功能扩展能力
- ✅ 向后兼容的平滑迁移

系统现在具备了现代Web应用的所有特性，为用户提供了优秀的中文发音练习体验。
